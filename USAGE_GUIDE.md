# TMJ Extension 使用指南

## 功能概述

TMJ Extension 的 Data Manager 模块提供了简单的配准数据组织功能:

1. **选择配准图像**: 从已加载的体积中选择 Fixed 和 Moving Volume
2. **导入新图像**: 或从文件加载新的医学影像
3. **场景组织**: 将配准数据组织到**两层文件夹结构**中,便于管理

## 场景文件夹结构

插件采用**两层文件夹结构**来组织配准流程:

```
📁 TMJ_配准流程_20250122_143000  (配准流程总文件夹)
   └─ 📁 模块1_数据管理  (模块1的子文件夹)
      ├─ 📄 Fixed_Volume
      └─ 📄 Moving_Volume
   └─ 📁 模块2_配准结果  (将来的模块2)
   └─ 📁 模块3_分割结果  (将来的模块3)
   ...
```

**设计理念:**
- **总文件夹**: 代表整个 TMJ 配准流程,包含所有模块的结果
- **模块子文件夹**: 每个模块的输出独立存放,便于管理和追溯
- **可扩展**: 方便后续添加更多模块(配准、分割、测量等)

## 使用步骤

### 方法一: 使用已加载的数据

1. 在 3D Slicer 中加载您的 CT 和 MR 图像
2. 打开 **TMJ Extension** 模块
3. 在 **Fixed Volume** 下拉框中选择 CT 图像 (提示: 通常选择 CT 图像作为固定图像)
4. 在 **Moving Volume** 下拉框中选择 MR 图像 (提示: 通常选择 MR 图像作为浮动图像)
5. 设置配准流程文件夹:
   - **总文件夹名称**: 默认为 `TMJ_配准流程_日期时间`,代表整个配准流程
   - **模块1子文件夹**: 默认为 `模块1_数据管理`,存放当前模块的结果
6. 点击 **加载配准数据** 按钮

### 方法二: 导入新文件

1. 打开 **TMJ Extension** 模块
2. 点击 **加载 Fixed Volume** 按钮,选择 CT 图像文件
3. 点击 **加载 Moving Volume** 按钮,选择 MR 图像文件
4. 设置总文件夹和模块子文件夹名称
5. 点击 **加载配准数据** 按钮

## 结果说明

加载成功后,您将在 3D Slicer 的 **Subject Hierarchy** (数据) 面板中看到:

```
📁 TMJ_配准流程_20250122_143020  (总文件夹)
   └─ � 模块1_数据管理  (模块1子文件夹)
      ├─ �📄 Fixed_Volume  (CT 图像副本)
      └─ 📄 Moving_Volume  (MR 图像副本)
```

**文件夹说明:**
- **总文件夹**: 如果已存在同名文件夹,将直接使用,不会重复创建
- **模块子文件夹**: 每次加载都会创建新的子文件夹
- **可扩展**: 后续模块(配准、分割等)的结果将添加到同一总文件夹下

## 重要提示

1. **数据类型提示**: 
   - Fixed Volume 通常是 CT 图像
   - Moving Volume 通常是 MR 图像
   - 这些只是提示,不会强制验证图像类型

2. **场景文件夹**: 
   - 文件夹仅在 3D Slicer 场景中创建
   - 不会创建磁盘上的物理文件夹
   - 如需保存,请使用 File → Save 保存整个场景

3. **数据副本**: 
   - 原始数据保持不变
   - 文件夹中的是数据副本
   - 所有图像信息(HU值、间距等)都会保留

4. **后续操作**: 
   - 可以在此文件夹中继续添加配准结果
   - 方便管理整个配准流程的所有数据
   - 场景可以保存为 .mrb 或 .mrml 文件

## 日志查看

展开 **日志与错误信息** 区域查看详细操作记录:
- ✓ 表示成功操作
- ✗ 表示错误信息

## 常见问题

**Q: 为什么提示 CT/MR?**  
A: 这只是常规配准流程的提示,您可以选择任何类型的体积数据。

**Q: 数据会被修改吗?**  
A: 不会,插件创建的是数据副本,原始数据不受影响。

**Q: 如何保存场景?**  
A: 使用 3D Slicer 的 File → Save 功能保存整个场景(.mrb 或 .mrml)。

**Q: 可以创建多个配准文件夹吗?**  
A: 可以,每次点击加载都会创建一个新的文件夹。
